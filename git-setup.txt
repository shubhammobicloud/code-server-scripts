1Ô∏è‚É£ Create the wrapper directory
sudo mkdir -p /opt/code-git-wrapper
sudo chown root:root /opt/code-git-wrapper
sudo chmod 755 /opt/code-git-wrapper
2Ô∏è‚É£ Create the git wrapper (THIS IS THE KEY PART)
sudo nano /opt/code-git-wrapper/git
3Ô∏è‚É£ Make it executable
sudo chmod 755 /opt/code-git-wrapper/git
sudo chown root:root /opt/code-git-wrapper/git


1Ô∏è‚É£ Edit the systemd service
sudo nano /etc/systemd/system/code-server@mahesh.service
2Ô∏è‚É£ Replace the Environment=PATH=... line
Environment=PATH=/opt/code-git-wrapper:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
3Ô∏è‚É£ Reload systemd properly (mandatory)
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl restart code-server@mahesh
üß™ VERIFY (inside VS Code terminal)
which git
/opt/code-git-wrapper/git


-------------------
‚úÖ Step 1: Create a sudoers include file (BEST PRACTICE)
sudo visudo -f /etc/sudoers.d/code-git-wrapper
‚úÖ Step 2: Add this exact content
üîí Allow only the wrapper, nothing else
# Allow specific users to run git wrapper as root
Cmnd_Alias GIT_WRAPPER = /opt/code-git-wrapper/git *
mahesh ALL=(root) NOPASSWD: GIT_WRAPPER
-----------------
 ****insteed above changed wrapper
‚úÖ Correct (works with NoNewPrivileges)
exec env GIT_SSH_COMMAND="ssh -i $SSH_KEY -o StrictHostKeyChecking=no" /usr/bin/git "$@"
‚úÖ Correct (works with NoNewPrivileges)
sudo chown root:gitssh /etc/git-ssh/deploy_key
sudo chmod 440 /etc/git-ssh/deploy_key
sudo usermod -aG gitssh mahesh
‚úî User can read key
‚úî Cannot modify key
‚úî No sudo needed
‚úî Fully secure